import{a as T,c as an,d as rn,e as N}from"./chunk-463B3NF7.mjs";import{r as en,u as y}from"./chunk-6DDSU7HN.mjs";import{a as nn}from"./chunk-PY23BQ2H.mjs";import{b as tn}from"./chunk-NZFKPV67.mjs";import{a as Y}from"./chunk-L6RINMT6.mjs";import{a as Q}from"./chunk-CPCS5KIA.mjs";import{a as f}from"./chunk-T7YRD4PM.mjs";import{a as J}from"./chunk-C2IJG37E.mjs";import{a as L,c as Z,d as j}from"./chunk-YDXU6ALO.mjs";import{c as q,d as v,e as H,f as F,g as K,h as X,i as z}from"./chunk-PVEPP4HR.mjs";import{b as D,d as R,e as $,f as M}from"./chunk-H6QWMF3Q.mjs";import{a as O,b as l,d as A}from"./chunk-LBU3LV7I.mjs";import{a as V}from"./chunk-BOYYQAB4.mjs";import{a as E,b as p}from"./chunk-SQQ2424E.mjs";import{i as B,j as k}from"./chunk-UJYWEIQ2.mjs";import{a as b,c as W}from"./chunk-XWVMFCW3.mjs";import{a as P,c as S}from"./chunk-F6REP536.mjs";import{b as u}from"./chunk-BF46IXHH.mjs";import{a as _}from"./chunk-AH44UPM4.mjs";import{a as C}from"./chunk-WV5AD4IE.mjs";import{b as I}from"./chunk-BCUSI3N6.mjs";import{b as U,c as G}from"./chunk-L36ZHC7J.mjs";import{g as x}from"./chunk-SCHZ67F3.mjs";import{sha3_256 as mn}from"@noble/hashes/sha3";async function Vn(n){if(en(n))return yn(n);let{moduleAddress:t,moduleName:e,functionName:i}=y(n.function),a=await sn({key:"entry-function",moduleAddress:t,moduleName:e,functionName:i,aptosConfig:n.aptosConfig,abi:n.abi,fetch:an});return An({...n,abi:a})}function An(n){let t=n.abi,{moduleAddress:e,moduleName:i,functionName:a}=y(n.function),r=T(n.typeArguments);if(r.length!==t.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${t.typeParameters.length}, received ${r.length}`);let o=n.functionArguments.map((s,d)=>N(n.function,t,s,d,r));if(o.length!==t.parameters.length)throw new Error(`Too few arguments for '${e}::${i}::${a}', expected ${t.parameters.length} but got ${o.length}`);let c=F.build(`${e}::${i}`,a,r,o);if("multisigAddress"in n){let s=u.from(n.multisigAddress);return new H(new X(s,new z(c)))}return new v(c)}async function qn(n){let{moduleAddress:t,moduleName:e,functionName:i}=y(n.function),a=await sn({key:"view-function",moduleAddress:t,moduleName:e,functionName:i,aptosConfig:n.aptosConfig,abi:n.abi,fetch:rn});return fn({abi:a,...n})}function fn(n){let t=n.abi,{moduleAddress:e,moduleName:i,functionName:a}=y(n.function),r=T(n.typeArguments);if(r.length!==t.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${t.typeParameters.length}, received ${r.length}`);let o=n?.functionArguments?.map((c,s)=>N(n.function,t,c,s,r))??[];if(o.length!==t.parameters.length)throw new Error(`Too few arguments for '${e}::${i}::${a}', expected ${t.parameters.length} but got ${o.length}`);return F.build(`${e}::${i}`,a,r,o)}function yn(n){return new q(new K(I.fromHexInput(n.bytecode).toUint8Array(),T(n.typeArguments),n.functionArguments))}async function gn(n){let{aptosConfig:t,sender:e,payload:i,options:a,feePayerAddress:r}=n,o=async()=>x[t.network]?{chainId:x[t.network]}:{chainId:(await Y({aptosConfig:t})).chain_id},c=async()=>a?.gasUnitPrice?{gasEstimate:a.gasUnitPrice}:{gasEstimate:(await tn({aptosConfig:t})).gas_estimate},s=async()=>{let g=async()=>a?.accountSequenceNumber!==void 0?a.accountSequenceNumber:(await nn({aptosConfig:t,accountAddress:e})).sequence_number;if(r&&u.from(r).equals(u.ZERO))try{return await g()}catch{return 0}else return g()},[{chainId:d},{gasEstimate:m},h]=await Promise.all([o(),c(),s()]),{maxGasAmount:cn,gasUnitPrice:un,expireTimestamp:dn}={maxGasAmount:a?.maxGasAmount?BigInt(a.maxGasAmount):BigInt(2e5),gasUnitPrice:a?.gasUnitPrice??BigInt(m),expireTimestamp:a?.expireTimestamp??BigInt(Math.floor(Date.now()/1e3)+20)};return new L(u.from(e),BigInt(h),i,BigInt(cn),BigInt(un),BigInt(dn),new V(d))}async function vn(n){let{aptosConfig:t,sender:e,payload:i,options:a,feePayerAddress:r}=n,o=await gn({aptosConfig:t,sender:e,payload:i,options:a,feePayerAddress:r});if("secondarySignerAddresses"in n){let c=n.secondarySignerAddresses?.map(s=>u.from(s))??[];return new Q(o,c,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}return new J(o,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}function Hn(n){let{signerPublicKey:t,transaction:e,secondarySignersPublicKeys:i,feePayerPublicKey:a}=n,r=w(t);if(e.feePayerAddress){let c=new j(e.rawTransaction,e.secondarySignerAddresses??[],e.feePayerAddress),s=[];i&&(s=i.map(h=>w(h)));let d=w(a),m=new $(r,e.secondarySignerAddresses??[],s,{address:e.feePayerAddress,authenticator:d});return new f(c.raw_txn,m).bcsToBytes()}if(e.secondarySignerAddresses){let c=new Z(e.rawTransaction,e.secondarySignerAddresses),s=[];s=i.map(m=>w(m));let d=new R(r,e.secondarySignerAddresses,s);return new f(c.raw_txn,d).bcsToBytes()}let o;if(r instanceof l)o=new D(r.public_key,r.signature);else if(r instanceof A)o=new M(r);else throw new Error("Invalid public key");return new f(e.rawTransaction,o).bcsToBytes()}function w(n){if((n instanceof B||n instanceof b)&&(n=new E(n)),n instanceof E){if(n.publicKey instanceof P)return new A(n,new p(new S(new Uint8Array(64))));if(n.publicKey instanceof b)return new A(n,new p(new W(new Uint8Array(64))));if(n.publicKey instanceof B)return new A(n,new p(k.getSimulationSignature()))}return new l(new P(n.toUint8Array()),new S(new Uint8Array(64)))}function pn(n){let{transaction:t,feePayerAuthenticator:e,additionalSignersAuthenticators:i}=n,a=C(O,n.senderAuthenticator),r;if(t.feePayerAddress){if(!e)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");r=new $(a,t.secondarySignerAddresses??[],i??[],{address:t.feePayerAddress,authenticator:e})}else if(t.secondarySignerAddresses){if(!i)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");r=new R(a,t.secondarySignerAddresses,i)}else a instanceof l?r=new D(a.public_key,a.signature):r=new M(a);return new f(t.rawTransaction,r).bcsToBytes()}function on(n){let t=mn.create();for(let e of n)t.update(e);return t.digest()}var ln=on(["APTOS::Transaction"]);function Kn(n){let t=pn(n);return new I(on([ln,new Uint8Array([0]),t])).toString()}async function sn({key:n,moduleAddress:t,moduleName:e,functionName:i,aptosConfig:a,abi:r,fetch:o}){return r!==void 0?r:_(async()=>o(t,e,i,a),`${n}-${a.network}-${t}-${e}-${i}`,1e3*60*5)()}export{Vn as a,An as b,qn as c,fn as d,gn as e,vn as f,Hn as g,w as h,pn as i,on as j,Kn as k};
//# sourceMappingURL=chunk-PZAA2YYO.mjs.map